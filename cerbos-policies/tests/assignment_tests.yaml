---
name: Assignment Policy Test Suite
description: Tests for assignment resource policy
principals:
  admin_user:
    id: admin-123
    roles:
      - admin
    attr:
      organizationId: org-sports-league
      primaryRegionId: region-north
      regionIds:
        - region-north
      isActive: true

  assignor_user:
    id: assignor-456
    roles:
      - assignor
    attr:
      organizationId: org-sports-league
      primaryRegionId: region-north
      regionIds:
        - region-north
      isActive: true

  referee_user:
    id: referee-789
    roles:
      - referee
    attr:
      organizationId: org-sports-league
      primaryRegionId: region-north
      regionIds:
        - region-north
      isActive: true

resources:
  pending_assignment:
    kind: assignment
    id: assignment-123
    attr:
      organizationId: org-sports-league
      gameRegionId: region-north
      refereeId: referee-789
      status: pending
      createdBy: assignor-456

  confirmed_assignment:
    kind: assignment
    id: assignment-456
    attr:
      organizationId: org-sports-league
      gameRegionId: region-north
      refereeId: referee-789
      status: confirmed
      createdBy: assignor-456

  completed_assignment:
    kind: assignment
    id: assignment-789
    attr:
      organizationId: org-sports-league
      gameRegionId: region-north
      refereeId: referee-789
      status: completed
      createdBy: assignor-456

  other_referee_assignment:
    kind: assignment
    id: assignment-999
    attr:
      organizationId: org-sports-league
      gameRegionId: region-north
      refereeId: referee-111
      status: pending
      createdBy: assignor-456

tests:
  - name: Admin can do everything in their organization
    input:
      principals:
        - admin_user
      resources:
        - pending_assignment
      actions:
        - view
        - create
        - update
        - delete
        - accept
        - decline
    expected:
      - principal: admin_user
        resource: pending_assignment
        actions:
          view: EFFECT_ALLOW
          create: EFFECT_ALLOW
          update: EFFECT_ALLOW
          delete: EFFECT_ALLOW
          accept: EFFECT_ALLOW
          decline: EFFECT_ALLOW

  - name: Assignor can view assignments in their region
    input:
      principals:
        - assignor_user
      resources:
        - pending_assignment
      actions:
        - view
        - list
    expected:
      - principal: assignor_user
        resource: pending_assignment
        actions:
          view: EFFECT_ALLOW
          list: EFFECT_ALLOW

  - name: Assignor can create assignments
    input:
      principals:
        - assignor_user
      resources:
        - pending_assignment
      actions:
        - create
    expected:
      - principal: assignor_user
        resource: pending_assignment
        actions:
          create: EFFECT_ALLOW

  - name: Assignor can update pending assignments
    input:
      principals:
        - assignor_user
      resources:
        - pending_assignment
      actions:
        - update
    expected:
      - principal: assignor_user
        resource: pending_assignment
        actions:
          update: EFFECT_ALLOW

  - name: Assignor cannot update completed assignments
    input:
      principals:
        - assignor_user
      resources:
        - completed_assignment
      actions:
        - update
    expected:
      - principal: assignor_user
        resource: completed_assignment
        actions:
          update: EFFECT_DENY

  - name: Assignor can delete their own non-completed assignments
    input:
      principals:
        - assignor_user
      resources:
        - pending_assignment
      actions:
        - delete
    expected:
      - principal: assignor_user
        resource: pending_assignment
        actions:
          delete: EFFECT_ALLOW

  - name: Referee can view their own assignments
    input:
      principals:
        - referee_user
      resources:
        - pending_assignment
      actions:
        - view
    expected:
      - principal: referee_user
        resource: pending_assignment
        actions:
          view: EFFECT_ALLOW

  - name: Referee cannot view other referee assignments
    input:
      principals:
        - referee_user
      resources:
        - other_referee_assignment
      actions:
        - view
    expected:
      - principal: referee_user
        resource: other_referee_assignment
        actions:
          view: EFFECT_DENY

  - name: Referee can accept their own pending assignments
    input:
      principals:
        - referee_user
      resources:
        - pending_assignment
      actions:
        - accept
        - decline
    expected:
      - principal: referee_user
        resource: pending_assignment
        actions:
          accept: EFFECT_ALLOW
          decline: EFFECT_ALLOW

  - name: Referee cannot accept completed assignments
    input:
      principals:
        - referee_user
      resources:
        - completed_assignment
      actions:
        - accept
        - decline
    expected:
      - principal: referee_user
        resource: completed_assignment
        actions:
          accept: EFFECT_DENY
          decline: EFFECT_DENY

  - name: Referee can update their confirmed assignments
    input:
      principals:
        - referee_user
      resources:
        - confirmed_assignment
      actions:
        - update
    expected:
      - principal: referee_user
        resource: confirmed_assignment
        actions:
          update: EFFECT_ALLOW

  - name: Referee cannot create or delete assignments
    input:
      principals:
        - referee_user
      resources:
        - pending_assignment
      actions:
        - create
        - delete
    expected:
      - principal: referee_user
        resource: pending_assignment
        actions:
          create: EFFECT_DENY
          delete: EFFECT_DENY